<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sacol√£o Calculanos - An√°lises</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1300px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 30px; }
        h1 { color: #27ae60; margin-bottom: 30px; border-bottom: 3px solid #27ae60; padding-bottom: 10px; }
        .section { margin-bottom: 40px; padding: 20px; background: #f9f9f9; border-left: 4px solid #27ae60; border-radius: 4px; }
        .section h2 { color: #27ae60; font-size: 20px; margin-bottom: 15px; }
        button { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:hover { background: #229954; }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .metric { background: white; padding: 15px; border-radius: 4px; border-top: 3px solid #27ae60; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .metric-value { font-size: 24px; font-weight: bold; color: #27ae60; }
        .metric-label { font-size: 12px; color: #999; margin-top: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #27ae60; color: white; padding: 10px; text-align: left; }
        td { padding: 8px; border-bottom: 1px solid #ddd; }
        tr:hover { background: #f5f5f5; }
        .chart { background: white; padding: 15px; border-radius: 4px; margin: 15px 0; }
        svg { max-width: 100%; }
        .alert { padding: 12px; border-radius: 4px; margin: 15px 0; }
        .alert-warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .alert-success { background: #d4edda; border-left: 4px solid #28a745; }
        .alert-danger { background: #f8d7da; border-left: 4px solid #dc3545; }
        .interpretation { background: #e8f5e9; padding: 12px; border-left: 4px solid #27ae60; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü•¨ Sacol√£o Calculanos - Sistema de Previs√£o</h1>

        <div class="section">
            <h2>üì¶ Resumo do Produto</h2>
            <button onclick="runProductSummary()">Carregar</button>
            <div id="product-output"></div>
        </div>

        <div class="section">
            <h2>üìà Previs√£o de Demanda</h2>
            <button onclick="runDemandForecast()">Executar</button>
            <div id="demand-output"></div>
        </div>

        <div class="section">
            <h2>üîÑ An√°lise de Perecibilidade</h2>
            <button onclick="runPerecibilityAnalysis()">Analisar</button>
            <div id="perecibility-output"></div>
        </div>

        <div class="section">
            <h2>üì• Simula√ß√£o de Estoque (30 dias)</h2>
            <button onclick="runCompleteSimulation()">Simular</button>
            <div id="simulation-output"></div>
        </div>

        <div class="section">
            <h2>üéØ Otimiza√ß√£o EOQ</h2>
            <button onclick="runOptimizationAnalysis()">Calcular</button>
            <div id="optimization-output"></div>
        </div>

        <div class="section">
            <h2>üì± Dashboard Integrado</h2>
            <button onclick="runFullDashboard()">Gerar</button>
            <div id="dashboard-output"></div>
        </div>
    </div>

    <script src="./assets/js/math_engine.js"></script>
    <script>
        const formData = {
            produto: { nome: "Ma√ß√£ Gala", categoria: "Fruta" },
            demanda: { media: 35, variacao: 13, crescimento: true },
            estoque: { inicial: 90, minimo: 20 },
            perecibilidade: { taxa_perda_pct: 1.5, prazo_validade: 15 },
            reposicao: { quantidade: 85, lead_time: 3 }
        };

        function drawChart(data, yKey, title, yLabel, h=350) {
            if (!data || data.length === 0) return '';
            const w = 900, p = 70, pb = 60;
            const y_vals = data.map(d => d[yKey]);
            const max_y = Math.max(...y_vals), min_y = Math.min(...y_vals);
            const range = max_y - min_y || 1;
            
            let svg = `<svg width="${w}" height="${h}" style="border:1px solid #ddd; background:#fff; font-family: 'Segoe UI', sans-serif;">`;
            
            // Grid horizontal com linhas e valores
            for (let i = 0; i <= 5; i++) {
                const y = p + (i / 5) * (h - p - pb);
                const val = max_y - (i / 5) * range;
                svg += `<line x1="${p}" y1="${y}" x2="${w - 30}" y2="${y}" stroke="#eee" stroke-width="1"/>`;
                svg += `<text x="${p - 5}" y="${y + 4}" font-size="11" fill="#666" text-anchor="end">${val.toFixed(1)}</text>`;
            }
            
            // Pontos e linha
            let pts = [];
            for (let i = 0; i < data.length; i++) {
                const x = p + (i / (data.length - 1 || 1)) * (w - p - 30);
                const y = p + (h - p - pb) - ((data[i][yKey] - min_y) / range) * (h - p - pb);
                pts.push({x, y, i});
            }
            
            let path = 'M';
            for (let i = 0; i < pts.length; i++) {
                path += i === 0 ? ` ${pts[i].x},${pts[i].y}` : ` L ${pts[i].x},${pts[i].y}`;
            }
            svg += `<path d="${path}" stroke="#27ae60" stroke-width="2.5" fill="none"/>`;
            for (let pt of pts) {
                svg += `<circle cx="${pt.x}" cy="${pt.y}" r="3" fill="#27ae60" stroke="#fff" stroke-width="1"/>`;
            }
            
            // Eixos
            svg += `<line x1="${p}" y1="${p}" x2="${p}" y2="${h - pb}" stroke="#333" stroke-width="2"/>`;
            svg += `<line x1="${p}" y1="${h - pb}" x2="${w - 20}" y2="${h - pb}" stroke="#333" stroke-width="2"/>`;
            
            // Setas dos eixos
            svg += `<polygon points="${p-5},${p} ${p},${p-8} ${p+5},${p}" fill="#333"/>`;
            svg += `<polygon points="${w-15},${h-pb} ${w-8},${h-pb-5} ${w-8},${h-pb+5}" fill="#333"/>`;
            
            // Label eixo Y
            svg += `<text x="15" y="${h/2}" font-size="12" fill="#666" text-anchor="middle" transform="rotate(-90 15 ${h/2})">${yLabel}</text>`;
            
            // Labels eixo X (a cada 5 dias ou menos)
            const step = Math.ceil(data.length / 6);
            for (let i = 0; i < data.length; i += step) {
                const pt = pts[i];
                svg += `<text x="${pt.x}" y="${h - pb + 18}" font-size="11" fill="#666" text-anchor="middle">Dia ${i+1}</text>`;
            }
            
            // T√≠tulo do gr√°fico
            svg += `<text x="${w/2}" y="25" font-size="14" font-weight="bold" fill="#27ae60" text-anchor="middle">${title}</text>`;
            
            // Legenda
            svg += `<circle cx="${w - 120}" cy="45" r="3" fill="#27ae60"/>`;
            svg += `<text x="${w - 110}" y="50" font-size="11" fill="#666">${yLabel}</text>`;
            
            svg += `</svg>`;
            return svg;
        }

        function runProductSummary() {
            const {produto, demanda, estoque, perecibilidade, reposicao} = formData;
            let html = `
            <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                üìã Consolida√ß√£o de todos os 6 formul√°rios com par√¢metros de entrada para as simula√ß√µes
            </p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div style="background: #e8f5e9; padding: 15px; border-radius: 4px; border-left: 4px solid #27ae60;">
                    <strong style="color: #27ae60;">ü•¨ PRODUTO</strong>
                    <table style="width: 100%; margin-top: 8px; font-size: 13px;">
                        <tr><td>Nome:</td><td style="text-align: right;"><strong>${produto.nome}</strong></td></tr>
                        <tr><td>Categoria:</td><td style="text-align: right;"><strong>${produto.categoria}</strong></td></tr>
                    </table>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 4px; border-left: 4px solid #ffc107;">
                    <strong style="color: #856404;">üìà DEMANDA</strong>
                    <table style="width: 100%; margin-top: 8px; font-size: 13px;">
                        <tr><td>M√©dia:</td><td style="text-align: right;"><strong>${demanda.media} kg/dia</strong></td></tr>
                        <tr><td>Varia√ß√£o:</td><td style="text-align: right;"><strong>¬±${demanda.variacao}%</strong></td></tr>
                        <tr><td>Crescimento:</td><td style="text-align: right;"><strong>${demanda.crescimento ? 'üìà Sim' : '‚û°Ô∏è N√£o'}</strong></td></tr>
                    </table>
                </div>
                
                <div style="background: #cfe9ff; padding: 15px; border-radius: 4px; border-left: 4px solid #0066cc;">
                    <strong style="color: #004085;">üì¶ ESTOQUE</strong>
                    <table style="width: 100%; margin-top: 8px; font-size: 13px;">
                        <tr><td>Inicial:</td><td style="text-align: right;"><strong>${estoque.inicial} kg</strong></td></tr>
                        <tr><td>M√≠nimo:</td><td style="text-align: right;"><strong>${estoque.minimo} kg</strong></td></tr>
                        <tr><td>Buffer:</td><td style="text-align: right;"><strong>${(estoque.inicial - estoque.minimo)} kg</strong></td></tr>
                    </table>
                </div>
                
                <div style="background: #f8d7da; padding: 15px; border-radius: 4px; border-left: 4px solid #dc3545;">
                    <strong style="color: #721c24;">‚ò†Ô∏è PERECIBILIDADE</strong>
                    <table style="width: 100%; margin-top: 8px; font-size: 13px;">
                        <tr><td>Taxa/dia:</td><td style="text-align: right;"><strong>${perecibilidade.taxa_perda_pct}%</strong></td></tr>
                        <tr><td>Validade:</td><td style="text-align: right;"><strong>${perecibilidade.prazo_validade} dias</strong></td></tr>
                        <tr><td>Perda 100kg:</td><td style="text-align: right;"><strong>${(100 * (1 - Math.pow(1 - perecibilidade.taxa_perda_pct/100, perecibilidade.prazo_validade))).toFixed(0)} kg</strong></td></tr>
                    </table>
                </div>
                
                <div style="background: #d4edda; padding: 15px; border-radius: 4px; border-left: 4px solid #28a745;">
                    <strong style="color: #155724;">üîÑ REPOSI√á√ÉO</strong>
                    <table style="width: 100%; margin-top: 8px; font-size: 13px;">
                        <tr><td>Quantidade:</td><td style="text-align: right;"><strong>${reposicao.quantidade} kg</strong></td></tr>
                        <tr><td>Lead time:</td><td style="text-align: right;"><strong>${reposicao.lead_time} dias</strong></td></tr>
                        <tr><td>Ciclo:</td><td style="text-align: right;"><strong>${(reposicao.quantidade / demanda.media).toFixed(1)} dias</strong></td></tr>
                    </table>
                </div>
            </div>
            
            <div style="background: #f0f0f0; padding: 15px; border-radius: 4px; margin-top: 15px;">
                <strong style="color: #333; font-size: 13px;">üìä RESUMO DOS PAR√ÇMETROS</strong>
                <table style="width: 100%; margin-top: 10px; font-size: 12px;">
                    <tr><th style="background: #27ae60; color: white; padding: 8px; text-align: left;">Categoria</th><th style="background: #27ae60; color: white; padding: 8px; text-align: left;">Par√¢metro</th><th style="background: #27ae60; color: white; padding: 8px; text-align: right;">Valor</th></tr>
                    <tr style="background: #fff;"><td>Produto</td><td>Nome</td><td style="text-align: right;"><strong>${produto.nome}</strong></td></tr>
                    <tr style="background: #f9f9f9;"><td>Produto</td><td>Categoria</td><td style="text-align: right;">${produto.categoria}</td></tr>
                    <tr style="background: #fff;"><td rowspan="3">Demanda</td><td>M√©dia di√°ria</td><td style="text-align: right;"><strong>${demanda.media} kg/dia</strong></td></tr>
                    <tr style="background: #fff;"><td>Varia√ß√£o</td><td style="text-align: right;">¬±${demanda.variacao}%</td></tr>
                    <tr style="background: #fff;"><td>Com crescimento</td><td style="text-align: right;">${demanda.crescimento ? 'Sim' : 'N√£o'}</td></tr>
                    <tr style="background: #f9f9f9;"><td rowspan="2">Estoque</td><td>Inicial</td><td style="text-align: right;"><strong>${estoque.inicial} kg</strong></td></tr>
                    <tr style="background: #f9f9f9;"><td>M√≠nimo</td><td style="text-align: right;"><strong>${estoque.minimo} kg</strong></td></tr>
                    <tr style="background: #fff;"><td rowspan="2">Perecibilidade</td><td>Taxa perda/dia</td><td style="text-align: right;"><strong>${perecibilidade.taxa_perda_pct}%</strong></td></tr>
                    <tr style="background: #fff;"><td>Prazo validade</td><td style="text-align: right;"><strong>${perecibilidade.prazo_validade} dias</strong></td></tr>
                    <tr style="background: #f9f9f9;"><td rowspan="2">Reposi√ß√£o</td><td>Quantidade pedido</td><td style="text-align: right;"><strong>${reposicao.quantidade} kg</strong></td></tr>
                    <tr style="background: #f9f9f9;"><td>Lead time</td><td style="text-align: right;"><strong>${reposicao.lead_time} dias</strong></td></tr>
                </table>
            </div>
            
            <div class="interpretation" style="margin-top: 15px;">
                <strong>üí° PR√ìXIMOS PASSOS:</strong> Clique nos bot√µes abaixo para executar as simula√ß√µes espec√≠ficas:
                <ul style="margin: 10px 0 0 20px; font-size: 12px;">
                    <li><strong>Previs√£o de Demanda:</strong> Veja como a demanda varia em 30 dias com sazonalidade</li>
                    <li><strong>An√°lise de Perecibilidade:</strong> Veja quanto do produto se degrada</li>
                    <li><strong>Simula√ß√£o de Estoque:</strong> Integra√ß√£o completa de todos os fatores</li>
                    <li><strong>Otimiza√ß√£o EOQ:</strong> Descubra a quantidade ideal de reposi√ß√£o</li>
                    <li><strong>Dashboard Integrado:</strong> An√°lise consolidada com recomenda√ß√µes</li>
                </ul>
            </div>
            `;
            document.getElementById('product-output').innerHTML = html;
        }

        function runDemandForecast() {
            const forecast = MathEngine.forecastDemand(formData.demanda, 30);
            const med = forecast.reduce((a,b) => a+b.demanda, 0) / forecast.length;
            const tot = forecast.reduce((a,b) => a+b.demanda, 0);
            const pico = Math.max(...forecast.map(d=>d.demanda));
            const minimo = Math.min(...forecast.map(d=>d.demanda));
            let html = `
            <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                üìä Padr√£o sazonal (senoidal) + crescimento linear ao longo de 30 dias
            </p>
            <div class="metrics">
                <div class="metric"><div class="metric-value">${med.toFixed(1)}</div><div class="metric-label">M√©dia kg/dia</div></div>
                <div class="metric"><div class="metric-value">${tot.toFixed(0)}</div><div class="metric-label">Total 30 dias</div></div>
                <div class="metric"><div class="metric-value">${pico.toFixed(1)}</div><div class="metric-label">Pico kg/dia</div></div>
                <div class="metric"><div class="metric-value">${minimo.toFixed(1)}</div><div class="metric-label">M√≠nimo kg/dia</div></div>
            </div>
            <div class="chart">${drawChart(forecast, 'demanda', 'Previs√£o de Demanda (30 dias)', 'Demanda (kg/dia)', 380)}</div>
            <div class="interpretation">
                <strong>üí° Interpreta√ß√£o:</strong> A demanda varia de ${minimo.toFixed(1)} a ${pico.toFixed(1)} kg/dia. 
                A varia√ß√£o de ¬±${formData.demanda.variacao}% com ${formData.demanda.crescimento ? 'crescimento' : 'sem crescimento'} 
                resultam em padr√£o sazonal. Recomenda-se manter estoque m√≠nimo de ${(pico * 1.2).toFixed(0)} kg para cobrir picos.
            </div>
            `;
            document.getElementById('demand-output').innerHTML = html;
        }

        function runPerecibilityAnalysis() {
            const perec = MathEngine.simulatePerecibility(formData.perecibilidade, 100, 20);
            const perda = 100 - (perec[perec.length-1]?.quantidade || 0);
            const perda_pct = (perda / 100 * 100).toFixed(1);
            let html = `
            <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                üìâ Degrada√ß√£o exponencial: Q(t) = Q(t-1) √ó (1 - ${formData.perecibilidade.taxa_perda_pct}%/dia)
            </p>
            <div class="alert alert-warning">
                Taxa de perda: <strong>${formData.perecibilidade.taxa_perda_pct}%/dia</strong> | 
                Prazo de validade: <strong>${formData.perecibilidade.prazo_validade} dias</strong>
            </div>
            <div class="metrics">
                <div class="metric"><div class="metric-value">${perda.toFixed(1)}</div><div class="metric-label">Perda absoluta (kg)</div></div>
                <div class="metric"><div class="metric-value">${perda_pct}</div><div class="metric-label">Perda relativa (%)</div></div>
                <div class="metric"><div class="metric-value">${(perec[perec.length-1]?.quantidade || 0).toFixed(1)}</div><div class="metric-label">Qtd. restante (kg)</div></div>
                <div class="metric"><div class="metric-value">${(perec[perec.length-1]?.disponivel_pct || 0).toFixed(1)}</div><div class="metric-label">Dispon√≠vel (%)</div></div>
            </div>
            <div class="chart">${drawChart(perec, 'quantidade', 'An√°lise de Perecibilidade (Degrada√ß√£o)', 'Quantidade dispon√≠vel (kg)', 380)}</div>
            <div class="interpretation">
                <strong>üí° Interpreta√ß√£o:</strong> A cada dia, ${formData.perecibilidade.taxa_perda_pct}% do produto se degrada.
                Em ${formData.perecibilidade.prazo_validade} dias, apenas ${(perec[perec.length-1]?.quantidade || 0).toFixed(1)} kg permanecem vi√°veis.
                Isso representa uma perda de ${perda_pct}%. Recomenda-se rota√ß√£o de estoque (FIFO).
            </div>
            `;
            document.getElementById('perecibility-output').innerHTML = html;
        }

        function runCompleteSimulation() {
            const sim = MathEngine.completeStockSimulation({
                estoque_inicial: formData.estoque.inicial,
                demanda_media: formData.demanda.media,
                demanda_variacao: formData.demanda.variacao,
                taxa_perda: formData.perecibilidade.taxa_perda_pct,
                prazo_validade: formData.perecibilidade.prazo_validade,
                qtd_reposicao: formData.reposicao.quantidade,
                lead_time: formData.reposicao.lead_time,
                estoque_minimo: formData.estoque.minimo,
                dias: 30
            });
            
            const ruptura = sim.filter(s => s.ruptura).length;
            const perda_total = sim.reduce((a,b) => a+b.perda, 0);
            const dem_total = sim.reduce((a,b) => a+b.demanda, 0);
            const reposicoes = sim.filter(s=>s.reposicao_disparada).length;
            const estoque_minimo = Math.min(...sim.map(s => s.estoque));
            const estoque_maximo = Math.max(...sim.map(s => s.estoque));
            
            let html = `
            <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                üîÑ Integra√ß√£o de: demanda sazonal + perecibilidade (${formData.perecibilidade.taxa_perda_pct}%/dia) + reposi√ß√£o autom√°tica (${formData.reposicao.quantidade}kg a cada ${formData.reposicao.lead_time} dias)
            </p>
            ${ruptura > 0 ? `<div class="alert alert-danger">‚ö†Ô∏è <strong>RISCO DETECTADO:</strong> ${ruptura} dia(s) com ruptura (estoque = 0)</div>` : '<div class="alert alert-success">‚úÖ <strong>SEGURAN√áA OK:</strong> Sem ruptura durante 30 dias</div>'}
            <div class="metrics">
                <div class="metric"><div class="metric-value">${dem_total.toFixed(0)}</div><div class="metric-label">Demanda total (kg)</div></div>
                <div class="metric"><div class="metric-value">${perda_total.toFixed(0)}</div><div class="metric-label">Perda total (kg)</div></div>
                <div class="metric"><div class="metric-value">${reposicoes}</div><div class="metric-label">Reposi√ß√µes feitas</div></div>
                <div class="metric"><div class="metric-value">${estoque_minimo.toFixed(0)} - ${estoque_maximo.toFixed(0)}</div><div class="metric-label">Faixa estoque (kg)</div></div>
            </div>
            <div class="chart">${drawChart(sim, 'estoque', 'Evolu√ß√£o do Estoque (30 dias)', 'Estoque (kg)', 380)}</div>
            <div class="interpretation">
                <strong>üí° An√°lise:</strong> 
                O estoque varia entre ${estoque_minimo.toFixed(0)}kg e ${estoque_maximo.toFixed(0)}kg.
                ${ruptura > 0 ? `‚ö†Ô∏è <strong>H√° risco!</strong> Aumentar estoque inicial para ${(formData.estoque.inicial * 1.3).toFixed(0)}kg ou reduzir lead time.` : `‚úÖ Estrat√©gia √© segura com estoque inicial de ${formData.estoque.inicial}kg.`}
                Perda total: ${perda_total.toFixed(0)}kg em 30 dias.
            </div>
            `;
            document.getElementById('simulation-output').innerHTML = html;
        }

        function runOptimizationAnalysis() {
            const opt = MathEngine.optimizeReplenishment({
                demanda_media: formData.demanda.media,
                custo_estoque: 0.5,
                custo_reposicao: 50,
                lead_time: formData.reposicao.lead_time,
                taxa_perda: formData.perecibilidade.taxa_perda_pct
            });
            
            const atual_custo = (50 / (formData.reposicao.quantidade / formData.demanda.media)) + (formData.reposicao.quantidade / 2) * 0.5;
            const econ = (atual_custo - opt.custo_total_diario) / atual_custo * 100;
            const econ_mensal = (atual_custo - opt.custo_total_diario) * 30;
            
            let html = `
            <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                üéØ F√≥rmula EOQ: Q* = ‚àö(2√óD√óS / (H√ó(1+taxa))) onde D=demanda, S=custo reposi√ß√£o, H=custo manuten√ß√£o
            </p>
            <div class="alert alert-success">
                ‚úÖ <strong>EOQ Calculado:</strong> ${opt.quantidade_otima} kg a cada ${opt.ciclo_reposicao_dias} dias
            </div>
            <div class="metrics">
                <div class="metric"><div class="metric-value">${opt.quantidade_otima}</div><div class="metric-label">Qtd. √ìtima (kg)</div></div>
                <div class="metric"><div class="metric-value">${opt.ciclo_reposicao_dias}</div><div class="metric-label">Ciclo (dias)</div></div>
                <div class="metric"><div class="metric-value">${econ.toFixed(1)}%</div><div class="metric-label">Economia</div></div>
                <div class="metric"><div class="metric-value">R$ ${econ_mensal.toFixed(2)}</div><div class="metric-label">Ganho/m√™s</div></div>
            </div>
            <table>
                <tr>
                    <th>M√©trica</th>
                    <th>Estrat√©gia Atual</th>
                    <th>Estrat√©gia √ìtima (EOQ)</th>
                    <th>Diferen√ßa</th>
                </tr>
                <tr>
                    <td><strong>Quantidade/pedido</strong></td>
                    <td>${formData.reposicao.quantidade} kg</td>
                    <td>${opt.quantidade_otima} kg</td>
                    <td>${(opt.quantidade_otima - formData.reposicao.quantidade > 0 ? '+' : '')} ${(opt.quantidade_otima - formData.reposicao.quantidade).toFixed(0)} kg</td>
                </tr>
                <tr>
                    <td><strong>Ciclo entre reposi√ß√µes</strong></td>
                    <td>${(formData.reposicao.quantidade/formData.demanda.media).toFixed(1)} dias</td>
                    <td>${opt.ciclo_reposicao_dias} dias</td>
                    <td>${(opt.ciclo_reposicao_dias - (formData.reposicao.quantidade/formData.demanda.media) > 0 ? '+' : '')} ${(opt.ciclo_reposicao_dias - (formData.reposicao.quantidade/formData.demanda.media)).toFixed(1)} dias</td>
                </tr>
                <tr>
                    <td><strong>Custo di√°rio</strong></td>
                    <td>R$ ${atual_custo.toFixed(2)}</td>
                    <td>R$ ${opt.custo_total_diario.toFixed(2)}</td>
                    <td>R$ ${(opt.custo_total_diario - atual_custo).toFixed(2)}</td>
                </tr>
                <tr>
                    <td><strong>Estoque m√©dio</strong></td>
                    <td>${(formData.reposicao.quantidade/2).toFixed(1)} kg</td>
                    <td>${opt.estoque_medio.toFixed(1)} kg</td>
                    <td>${(opt.estoque_medio - formData.reposicao.quantidade/2).toFixed(1)} kg</td>
                </tr>
            </table>
            <div class="interpretation">
                <strong>üí° Recomenda√ß√£o:</strong> 
                Mudar para ${opt.quantidade_otima} kg a cada ${opt.ciclo_reposicao_dias} dias gera economia de 
                <strong>R$ ${econ_mensal.toFixed(2)}/m√™s</strong> (${econ.toFixed(1)}% de redu√ß√£o). 
                ${opt.quantidade_otima < formData.reposicao.quantidade ? 'Reduz' : 'Aumenta'} o estoque m√©dio em ${Math.abs(opt.estoque_medio - formData.reposicao.quantidade/2).toFixed(1)} kg.
            </div>
            `;
            document.getElementById('optimization-output').innerHTML = html;
        }

        function runFullDashboard() {
            const sim = MathEngine.completeStockSimulation({
                estoque_inicial: formData.estoque.inicial,
                demanda_media: formData.demanda.media,
                demanda_variacao: formData.demanda.variacao,
                taxa_perda: formData.perecibilidade.taxa_perda_pct,
                prazo_validade: formData.perecibilidade.prazo_validade,
                qtd_reposicao: formData.reposicao.quantidade,
                lead_time: formData.reposicao.lead_time,
                estoque_minimo: formData.estoque.minimo,
                dias: 30
            });
            
            const opt = MathEngine.optimizeReplenishment({
                demanda_media: formData.demanda.media,
                custo_estoque: 0.5,
                custo_reposicao: 50,
                lead_time: formData.reposicao.lead_time,
                taxa_perda: formData.perecibilidade.taxa_perda_pct
            });
            
            const dem = sim.reduce((a,b) => a+b.demanda, 0);
            const perda = sim.reduce((a,b) => a+b.perda, 0);
            const ruptura = sim.filter(s => s.ruptura).length;
            const taxa_ruptura = (ruptura/30*100).toFixed(1);
            const taxa_perda_pct = (perda/dem*100).toFixed(1);
            const eficiencia = (100 - parseFloat(taxa_perda_pct) - parseFloat(taxa_ruptura)).toFixed(1);
            
            let html = `
            <div style="background: linear-gradient(135deg, #27ae60, #229954); color: white; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                <h3 style="margin: 0 0 5px 0; font-size: 22px;">${formData.produto.nome}</h3>
                <p style="margin: 0; font-size: 13px; opacity: 0.9;">Categoria: <strong>${formData.produto.categoria}</strong> | Simula√ß√£o: 30 dias</p>
                <p style="margin: 8px 0 0 0; font-size: 12px; opacity: 0.8;">Demanda sazonal com perecibilidade e reposi√ß√£o autom√°tica</p>
            </div>
            
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value">${dem.toFixed(0)}</div>
                    <div class="metric-label">Demanda Total (kg)</div>
                    <div style="font-size: 11px; color: #999; margin-top: 5px;">30 dias √ó ~${(dem/30).toFixed(1)} kg/dia</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${taxa_perda_pct}%</div>
                    <div class="metric-label">Taxa de Perda</div>
                    <div style="font-size: 11px; color: #999; margin-top: 5px;">${perda.toFixed(0)} kg perdidos</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: ${ruptura > 0 ? '#dc3545' : '#28a745'};">${taxa_ruptura}%</div>
                    <div class="metric-label">Taxa de Ruptura</div>
                    <div style="font-size: 11px; color: #999; margin-top: 5px;">${ruptura} dia(s) fora de estoque</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${eficiencia}%</div>
                    <div class="metric-label">Efici√™ncia Geral</div>
                    <div style="font-size: 11px; color: #999; margin-top: 5px;">Sem perda nem ruptura</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 25px 0;">
                <div style="background: #f9f9f9; padding: 15px; border-radius: 4px; border-left: 3px solid #27ae60;">
                    <strong style="color: #27ae60; font-size: 13px;">üìä ESTRAT√âGIA ATUAL</strong>
                    <table style="width: 100%; margin-top: 10px; font-size: 12px;">
                        <tr><td>Qtd./pedido:</td><td style="text-align: right;"><strong>${formData.reposicao.quantidade} kg</strong></td></tr>
                        <tr><td>Ciclo:</td><td style="text-align: right;"><strong>${(formData.reposicao.quantidade/formData.demanda.media).toFixed(1)} dias</strong></td></tr>
                        <tr><td>Estoque m√©dio:</td><td style="text-align: right;"><strong>${(formData.reposicao.quantidade/2).toFixed(0)} kg</strong></td></tr>
                        <tr><td>Lead time:</td><td style="text-align: right;"><strong>${formData.reposicao.lead_time} dias</strong></td></tr>
                    </table>
                </div>
                
                <div style="background: #e8f5e9; padding: 15px; border-radius: 4px; border-left: 3px solid #27ae60;">
                    <strong style="color: #27ae60; font-size: 13px;">üéØ ESTRAT√âGIA √ìTIMA (EOQ)</strong>
                    <table style="width: 100%; margin-top: 10px; font-size: 12px;">
                        <tr><td>Qtd./pedido:</td><td style="text-align: right;"><strong>${opt.quantidade_otima} kg</strong></td></tr>
                        <tr><td>Ciclo:</td><td style="text-align: right;"><strong>${opt.ciclo_reposicao_dias} dias</strong></td></tr>
                        <tr><td>Estoque m√©dio:</td><td style="text-align: right;"><strong>${opt.estoque_medio.toFixed(0)} kg</strong></td></tr>
                        <tr><td>Custo/dia:</td><td style="text-align: right;"><strong>R$ ${opt.custo_total_diario.toFixed(2)}</strong></td></tr>
                    </table>
                </div>
            </div>
            
            <div class="chart">${drawChart(sim, 'estoque', 'Evolu√ß√£o do Estoque durante 30 dias', 'Estoque (kg)', 400)}</div>
            
            <div class="interpretation">
                <strong>üìå RESUMO EXECUTIVO:</strong><br>
                <strong>Demanda:</strong> ${dem.toFixed(0)} kg em 30 dias (m√©dia ${(dem/30).toFixed(1)} kg/dia)<br>
                <strong>Perdas:</strong> ${perda.toFixed(0)} kg (${taxa_perda_pct}%) por perecibilidade<br>
                <strong>Ruptura:</strong> ${ruptura > 0 ? `‚ö†Ô∏è ${ruptura} dia(s) (${taxa_ruptura}%) - AUMENTAR ESTOQUE` : `‚úÖ Nenhum dia sem estoque (${taxa_ruptura}%)`}<br>
                <strong>Efici√™ncia:</strong> ${eficiencia}%<br><br>
                <strong>üí° RECOMENDA√á√ÉO:</strong> 
                Implementar estrat√©gia EOQ de ${opt.quantidade_otima} kg a cada ${opt.ciclo_reposicao_dias} dias para economizar 
                R$ ${((1 - opt.custo_total_diario/((50 / (formData.reposicao.quantidade / formData.demanda.media)) + (formData.reposicao.quantidade / 2) * 0.5)) * 100).toFixed(1)}% nos custos.
            </div>
            `;
            document.getElementById('dashboard-output').innerHTML = html;
        }
    </script>
</body>
</html>
